<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>三、 基于电刺激的触觉反馈 |    Zhibin Li</title>
    <meta name="description" content="The description of the site.">
    <link rel="icon" href="./logo.png">
    
    <link rel="preload" href="./assets/css/0.styles.13c2aa69.css" as="style"><link rel="preload" href="./assets/js/app.66697a1b.js" as="script"><link rel="preload" href="./assets/js/2.992a38bb.js" as="script"><link rel="preload" href="./assets/js/4.b8fa839d.js" as="script"><link rel="prefetch" href="./assets/js/10.c563cb29.js"><link rel="prefetch" href="./assets/js/11.ec967b69.js"><link rel="prefetch" href="./assets/js/12.e936f4c5.js"><link rel="prefetch" href="./assets/js/13.837c2295.js"><link rel="prefetch" href="./assets/js/14.80a3e839.js"><link rel="prefetch" href="./assets/js/15.3d14f022.js"><link rel="prefetch" href="./assets/js/16.e53fa744.js"><link rel="prefetch" href="./assets/js/17.4da267f2.js"><link rel="prefetch" href="./assets/js/18.7f74fb71.js"><link rel="prefetch" href="./assets/js/19.ca645c71.js"><link rel="prefetch" href="./assets/js/20.c11e3a44.js"><link rel="prefetch" href="./assets/js/21.149f2fb8.js"><link rel="prefetch" href="./assets/js/22.4f13a706.js"><link rel="prefetch" href="./assets/js/23.f4523abd.js"><link rel="prefetch" href="./assets/js/24.bc5fccf9.js"><link rel="prefetch" href="./assets/js/3.3063dda1.js"><link rel="prefetch" href="./assets/js/5.45b14262.js"><link rel="prefetch" href="./assets/js/6.f3859bbf.js"><link rel="prefetch" href="./assets/js/7.7007339e.js"><link rel="prefetch" href="./assets/js/8.9fc3e0e6.js"><link rel="prefetch" href="./assets/js/9.71c39c71.js">
    <link rel="stylesheet" href="./assets/css/0.styles.13c2aa69.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/./" class="home-link router-link-active"><!----> <span class="site-name">   Zhibin Li</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/./" class="nav-link">Home</a></div><div class="nav-item"><a href="/./#overview" class="nav-link">Overview</a></div><div class="nav-item"><a href="/./#publications" class="nav-link">Publications</a></div><div class="nav-item"><a href="/./#honors" class="nav-link">Honors</a></div><div class="nav-item"><a href="/./#interests" class="nav-link">Interests</a></div><div class="nav-item"><a href="/./blog/" class="nav-link router-link-active">Tech blog</a></div><div class="nav-item"><a href="https://github.com/jioy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/./" class="nav-link">Home</a></div><div class="nav-item"><a href="/./#overview" class="nav-link">Overview</a></div><div class="nav-item"><a href="/./#publications" class="nav-link">Publications</a></div><div class="nav-item"><a href="/./#honors" class="nav-link">Honors</a></div><div class="nav-item"><a href="/./#interests" class="nav-link">Interests</a></div><div class="nav-item"><a href="/./blog/" class="nav-link router-link-active">Tech blog</a></div><div class="nav-item"><a href="https://github.com/jioy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Blog</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/./blog/4.16路EIT电路/EIT.html" class="sidebar-link">一、 基于EIT技术的压力感知系统设计</a></li><li><a href="/./blog/2.FPGA_FDM/FPGA.html" class="sidebar-link">二、 基于FPGA的高性能离子电子皮肤感知系统</a></li><li><a href="/./blog/3.电刺激电路/STI.html" class="active sidebar-link">三、 基于电刺激的触觉反馈</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/./blog/3.电刺激电路/STI.html#_1-1-电触觉反馈基本原理" class="sidebar-link">1.1 电触觉反馈基本原理</a></li><li class="sidebar-sub-header"><a href="/./blog/3.电刺激电路/STI.html#_1-2-电刺激的产生与控制" class="sidebar-link">1.2 电刺激的产生与控制</a></li><li class="sidebar-sub-header"><a href="/./blog/3.电刺激电路/STI.html#_1-3-电极阵列设计" class="sidebar-link">1.3 电极阵列设计</a></li><li class="sidebar-sub-header"><a href="/./blog/3.电刺激电路/STI.html#_1-5-核心芯片编程" class="sidebar-link">1.5 核心芯片编程</a></li><li class="sidebar-sub-header"><a href="/./blog/3.电刺激电路/STI.html#_1-6-无线通信模块" class="sidebar-link">1.6 无线通信模块</a></li><li class="sidebar-sub-header"><a href="/./blog/3.电刺激电路/STI.html#_1-7-手机app设计" class="sidebar-link">1.7 手机APP设计</a></li><li class="sidebar-sub-header"><a href="/./blog/3.电刺激电路/STI.html#_1-8-触觉反馈感受实验" class="sidebar-link">1.8 触觉反馈感受实验</a></li></ul></li><li><a href="/./blog/1.power/power.html" class="sidebar-link">四、正负双电源设计方案</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="三、-基于电刺激的触觉反馈">三、 基于电刺激的触觉反馈</h1> <h1 id="_1-基于电刺激的触觉反馈">1. 基于电刺激的触觉反馈</h1> <p><strong>系统设计作者：李志斌（硬件设计），张宇轩（硬件及软件开发）</strong></p> <p>本文主要介绍基于电刺激的触觉反馈系统搭建，包括了电刺激的产生、电流大小的控制、高压开关调控等电路硬件设计环节以及单片机编程、手机蓝牙APP设计等软件设计环节，同时，还将本设备用于实际的触觉反馈任务中去，并展示了触觉感受效果。电刺激触觉反馈系统的整体框架可以用以下流程图。</p> <p><img src="./assets/img/image.4fa39825.png" alt="alt text"></p> <p>其中，绿色的为电源调控模块，负责产生稳定的3.3V工作电压以及128V的电刺激高压；中间的为主控制芯片MCU模块，负责与手机的蓝牙通信、电刺激输出位置控制以及电刺激强度的调控；电刺激经过电极阵列输出到人体皮肤上，刺激人触觉感受体，再由镜像电流源回流，以对电流大小进行控制。</p> <h2 id="_1-1-电触觉反馈基本原理">1.1 电触觉反馈基本原理</h2> <p>触觉反馈可以应用于像远程手术以及VR等应用场景，而基于电刺激的触觉反馈其原理主要是电流透过皮肤角质层时，其中皮下的Merkel’s disks 和Meissner’s Corpuscles 两种受体会产生相应的电触觉，受体同时也会对震动的频率产生一定的感知。</p> <p>Meissner’s Corpuscles也称为触觉小体，它们存在于真皮上部，但它们伸入表皮，它们对精细的触摸和压力做出反应，同时也对低频振动或颤动做出反应，它们是快速适应、充满流体、被包裹的神经元，具有小而明确的边界，对细微的细节有反应。因此，依靠电流刺激以上两种受体可以产生非常精细的触觉，并可凭此传递相应的触觉信息。</p> <h2 id="_1-2-电刺激的产生与控制">1.2 电刺激的产生与控制</h2> <p>本节会介绍电刺激产生与控制电路的设计细节。电刺激本质上是电流的穿透，而为让受体能够被电流所刺激，需要施加高压让电流穿透皮肤角质层，同时避免电流过大造成人体不适。</p> <ul><li>高压生成电路
通过DC-DC电路，可以将直流电压提升至预设值。本设备采用了两路DC-DC升压电路将电池标准电压3.3V分别提升至12V以及135V，以供后续电刺激使用，其中DC-DC的电路图所示。</li></ul> <p><img src="./assets/img/image-1.4ff93a31.png" alt="alt text"></p> <p>其中采用的DC-DC芯片为Analog Devices的LT8363型号DC-DC逆变转换器，其可通过对外部电路的设计实现升压等多种功能。
最终，DC-DC电路输出理想为135V的电压，用高压开关控制输出为50Hz的脉冲序列，可观察到最高电压输出可达122V，与理想值接近，其中示波器绘制的波形图如图所示。</p> <p><img src="./assets/img/image-2.0040e4ed.png" alt="alt text"></p> <ul><li>限流电路
若采用高压与皮肤接触，电流会有一个很大的瞬值，因此会给人造成触电的感觉。为控制电刺激的触觉在人体舒适范围中，需要通过限流电路控制电流的大小不能超过某个幅值，由此原因出发，设备采用了一个镜像电流电路控制电流大小。
镜像电流源的基础设计概念如图所示。</li></ul> <p><img src="./assets/img/image-3.18dceb36.png" alt="alt text"></p> <p>其中，DACA为单片机DAC产生的可控电压，NEG为电流经过皮肤的回流电流，SAMPLE为一个采样电压节点，实现对电流的实时监控，防止电流过大。
在单片机通过ADC对镜像电流源的输出采样，也就是在SAMPLE点对电压进行采样，其电压值变化如图所示</p> <p><img src="./assets/img/image-4.87bf360c.png" alt="alt text"></p> <p>镜像电流输出电压值变化（下图为上图的放大）
<img src="./assets/img/image-5.f7597be3.png" alt="alt text"></p> <p>此时为调控MCU输出周期为1s的电刺激序列，也就是皮肤感受为每1s电刺激一次，其中每次输出时的电刺激序列放大图如图3-7下图所示，每次电刺激由100Hz的脉冲序列构成，每次电刺激时间长度约为0.1s。
可以观察到，当开关闭合时，代表着镜像电流双路导通，电压大小为开关断开时的约为两倍，这是由于开关断开时只有DAC的单路导通，则总电流大小为开关闭合时的约为一半。</p> <ul><li>高压开关电路</li></ul> <p>在电刺激电极的输出端需要采用高压开关调控电刺激的有与无，因此，在电刺激输出端采用了一个美国微芯32路高压模拟开关HV2801实现对32个输出的调控，高压开关的设计如下图所示。</p> <p><img src="./assets/img/image-6.1fe06b42.png" alt="alt text"></p> <p>其中每一个开关都连接高压135V，开关的开断由DIN决定，其中DIN为32时间长度的0/1序列，0代表无电压，1代表3.3V电压，CLK则控制每一次对DIN采样的时间，采样时若为1，则代表该时间位置的开关开启，0/1序列控制0-31号开关的断或者是开。每当LE由高电平变低时，则代表对所有32个开关的一次设置，需要输入DIN序列设置好每一个开关，LE为高电平时则代表不对开关操作。CLR为复位flag，当CLR为高电平时，则为关闭所有开关，HV2801不工作，该复位信号则可用于危险情况的保护，当电流过大时将所有开关闭合。</p> <h2 id="_1-3-电极阵列设计">1.3 电极阵列设计</h2> <p>电刺激的输出位置，可以通过对电极阵列空间结构的编排实现控制，本触觉反馈设备设计的电极阵列如下图所示。</p> <p><img src="./assets/img/image-7.f3247bd7.png" alt="alt text"></p> <p>其中电触觉反馈阵列的像素尺寸为5<em>6，两电极间的间距为1.5cm，单电极的半径大小为2.5mm，整体的大小约为6.6cm</em>8.1cm。上端的接口统一接在PCB电路板设计的FPC电刺激输出处。
整个电极阵列可以很好地贴合在手臂上，其效果图如图所示。</p> <p><img src="./assets/img/image-8.d9322e39.png" alt="alt text"></p> <h2 id="_1-5-核心芯片编程">1.5 核心芯片编程</h2> <p>本设备核心芯片（MCU）采用的是ESP32-PICO-D4，该芯片集成了ADC、DAC与蓝牙模块，可采用Arduino进行编程，故易于使用。该核心芯片的外部电路图如下图所示。</p> <p><img src="./assets/img/image-9.a85f47bf.png" alt="alt text"></p> <p>其中，主芯片主要实现了以下几种功能：
（1）	串口通信。通过TXD与RXD实现和外界的串口通信，以将代码编程到主芯片上。
（2）	蓝牙通信。通过连接天线LNA实现蓝牙通信、信息交互。
（3）	DAC电压输出。通过DACA产生的电压控制镜像电流源，进而实现对电流的控制。
（4）	ADC采样。NEG1端口为对镜像电流源的采样，实现对实时电流的监测，防止电流过大。
（5）	控制32路高压开关。DIN、CS、CLK与CLR端口调控32路开关的中断与开启。
（6）	复位与写入模式控制。EN与IO0分别都外接了开关，其目的是可以手动调控芯片复位，当依次将EN与IO0设置为低电平时，芯片进入烧录模式，此时可以通过Arduino的IDE烧录代码。
在Arduino中，通过其自带的集成API可以实现对输出的控制。通过digitalWrite函数输出单IO口的高或低电平，dacWrite函数控制DAC输出电压值，analogRead函数则读取ADC采样电压值。
为实现实时对高压开关的控制，采用了一个以1ms为周期的定时器如图所示。</p> <p><img src="./assets/img/image-10.981f769e.png" alt="alt text"></p> <p>因为ESP32主频为80MHz，则先将定时器基础频率设置为1MHz，再设置其周期为1ms，同时在定时器中断函数中完成对全部32个开关的控制，即可实现每1ms对所有开关控制一次。</p> <h2 id="_1-6-无线通信模块">1.6 无线通信模块</h2> <p>该章节主要介绍了设备与手机进行蓝牙通讯的实现方式，同时，通过对手机APP的设计，可以远程控制电刺激的模式以及传递的触觉信息。
3.5.1蓝牙设置
ESP32在芯片内自带有蓝牙解码编码模块，只需要在LNA端口连接天线即可。其中关于天线电路的设计如图所示。</p> <p><img src="./assets/img/image-11.8c125c8c.png" alt="alt text"></p> <p>其中采用双电容、单电感设计以提高通讯的稳定性。
在蓝牙通讯时，单片机通过SerialBT.available函数判断蓝牙是否成功开启，若开启，检测收到的string字符串直到检索到“\xff”即蓝牙通信传递字符串的结尾，此时将持续记录到的数据读出，即可解码出接受到的命令，然后单片机再持续判断下次是否接收到蓝牙数据。
当需要通过蓝牙发送字符串时，则采用Arduino自带的Serial.println函数直接将字符串从天线发出。</p> <h2 id="_1-7-手机app设计">1.7 手机APP设计</h2> <p>在手机端，需要制作一款APP实现与触觉反馈设备的蓝牙通信，在能够发送信息的同时显示接收到的信息，并且配有按钮控制所想要反馈给人的触觉信息。因此，采用Android Studio作为IDE工具实现对手机APP的编写。
其中，关于蓝牙通信在安卓系统上的实现较为复杂，与本文研究背景关联不大，故采用了Android Studio官方示例帮助设计蓝牙APP。本文设计的APP界面如下图所示。
<img src="./assets/img/image-12.278102a8.png" alt="alt text"></p> <p>其中，关于字符串的收发功能以及蓝牙连接功能均已在最开始提供。关于按钮图案的设计存在于前面板xml文件中，其中下面的按钮均为./imageButton属性的按钮，其通过显示预存好的图片做为可按的按钮，然后，在主线程的java文件中写入按钮按下后需要执行的操作，在这里例如中间的Rand按钮，其xml文件代码以及激活函数如下图所示。</p> <p><img src="./assets/img/image-13.a25c7fad.png" alt="alt text"></p> <p><img src="./assets/img/image-14.3818c3cc.png" alt="alt text"></p> <p>可见当作为图片的按钮Rand被按下时，会调用random函数，其会利用集成好的蓝牙接口发送“random”的字符串，字符串通过手机蓝牙发出后，由单片机蓝牙接收，并进行随机产生一个方向触觉反馈的操作。</p> <p>手机APP下方其他的十个按钮为产生指定方向触觉反馈的按钮，其可控制触觉反馈设备产生代表某一个方向的触觉刺激。APP中间为字符串发送与显示端口，可以将对话框中的字符串发送至单片机，同时接收来自单片机的字符串信息并进行显示。例如图中所示的vup代表了提高电刺激的强度，手机会发送“vup”字符串给单片机告诉其提高电刺激强度，然后单片机会把调整的DAC的电压值发送至手机上进行显示。</p> <h2 id="_1-8-触觉反馈感受实验">1.8 触觉反馈感受实验</h2> <p>前面的模块介绍了硬件系统的基本原理，通过嘉立创的PCB设计IDE软件，可以将整套系统制作出来，其PCB设计图如图所示。</p> <p><img src="./assets/img/image-15.20a20767.png" alt="alt text"></p> <p>设备PCB尺寸大小约为5.56cm*2.72cm，体积较小便于穿戴，其中左侧的为蓝牙陶瓷天线，右侧的为32路高压开关以及FPC电极阵列连接口，上部分带有着USB插口以及3.3V稳压模块，中间的则是主控芯片MCU，MCU右侧则环绕着两块DC-DC芯片。
将整套触觉反馈设备穿戴至人手臂上，其效果图见图。</p> <p><img src="./assets/img/image-16.d3eff305.png" alt="alt text"></p> <p>图片上侧的是PCB电路以及镜像回流电极，下面的是电刺激的输出电极阵列，电极阵列由胶带包裹并贴合在手臂上。另一位操作者操作手机APP，令触觉反馈设备随机生成一个方向，并让触觉反馈设备产生该方向的电刺激反馈，由穿戴者通过触觉感受其所产生的是何种方向的触觉反馈。
对电刺激输出的编排为按照一定的顺序与方向激活或者关闭电刺激电极，其中对于代表四个方向向上、左上、向右、顺时针的电刺激输出布局图如下所示。</p> <p><img src="./assets/img/image-17.99ce6033.png" alt="alt text"></p> <p>其中箭头白色部分代表着首先激活的电刺激电极，红色代表后激活的电刺激电极。当输出为顺时针的方向时，依次激活上、右、下与左的箭头所在的电刺激阵列点。其他的六个方向电刺激输出顺序以此类推。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/./blog/2.FPGA_FDM/FPGA.html" class="prev">二、 基于FPGA的高性能离子电子皮肤感知系统</a></span> <span class="next"><a href="/./blog/1.power/power.html">四、正负双电源设计方案</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="./assets/js/app.66697a1b.js" defer></script><script src="./assets/js/2.992a38bb.js" defer></script><script src="./assets/js/4.b8fa839d.js" defer></script>
  </body>
</html>
